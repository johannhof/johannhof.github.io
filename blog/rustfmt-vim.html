<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Using rustfmt in Vim</title>
<link href='https://fonts.googleapis.com/css?family=Muli:400,300' rel='stylesheet' type='text/css'>
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha256-3dkvEK0WLHRJ7/Csr0BZjAWxERc5WH7bdeUya2aXxdU= sha512-+L4yy6FRcDGbXJ9mPG8MT/3UCDzwR9gPeyFNMCtInsol++5m3bk2bXWKdZjvybmohrAsn3Ua5x8gfLnbE1YkOg==" crossorigin="anonymous">
<link rel="stylesheet" href="/writ.min.css">
<link rel="stylesheet" href="/style.css" type="text/css" media="all" />
<link rel="alternate" href="/rss.xml" type="application/rss+xml" title="RSS" />

  </head>
<body data-route=blog>
  <nav class="menu">
  <a class="menu-item " href="/about/">Johann</a>
  <a class="menu-item current" href="/">Blog</a>
  <a class="menu-item" href="https://www.notion.so/johannhof/Johann-s-Scribbles-646639f7330b4147a2942172f36b6964">Scribbles</a>
  <a class="menu-item " href="/talks/">Talks</a>
  <a class="menu-item icon" href="http://github.com/johannhof"><i class="fa fa-github-square"></i></a>
  <a class="menu-item icon" href="http://twitter.com/johannh"><i class="fa fa-twitter-square"></i></a>
  <a class="menu-item icon" href="/rss.xml"><i class="fa fa-rss-square"></i></a>
  <hr>
</nav>

  <main>
    <article>
      <h1>Using rustfmt in Vim</h1>
      <time pubdate="pubdate">Nov 03, 2015</time>
      <p><a href="https://github.com/nrc/rustfmt">rustfmt</a> just added support for receiving code on stdin. This means that you can now pipe things into <code>rustfmt</code> on stdin and receive a plain formatted version of your input on stdout, the UNIX way.</p>
<pre style="background-color:#2b303b;">
<span style="background-color:#2b303b;color:#c0c5ce;">  echo &quot;pub fn main(){println!(\&quot;hello\&quot;);}&quot; | rustfmt

</span><span style="background-color:#2b303b;color:#c0c5ce;">  cat src/lib.rs | rustfmt
</span></pre>
<p>This enables us to write editor plugins that call <code>rustfmt</code> and replace the file content with the result from stdout.</p>
<p>Here's how to do it in Vim, my editor of heart.</p>
<h2>Integrating with Vim-Autoformat</h2>
<p><a href="https://github.com/Chiel92/vim-autoformat">Vim-Autoformat</a> is a neat plugin that allows you to define custom formatters to run on your code while you're editing it in Vim.</p>
<p>Only a few steps are required to make it work with rustfmt.</p>
<ol>
<li>
<p><strong>Install rustfmt</strong>, instructions can be found here: <a href="https://github.com/nrc/rustfmt#installation">https://github.com/nrc/rustfmt#installation</a></p>
<p>multirust run nightly cargo install --git https://github.com/nrc/rustfmt</p>
</li>
<li>
<p><strong>Install vim-autoformat</strong> with a plugin manager of your choice, I use <a href="https://github.com/junegunn/vim-plug">vim-plug</a></p>
<p>Plug 'Chiel92/vim-autoformat'</p>
</li>
<li>
<p><strong>Add rustfmt to the list of formatters.</strong> vim-autoformat comes with a set of predefined formatters for popular languages, but until my <a href="https://github.com/Chiel92/vim-autoformat/pull/87">pull request adding Rust</a> is merged we'll have to add it ourselves.</p>
</li>
</ol>
<p>Fortunately, it's quite easy. Just add the following two lines to your .vimrc:</p>
<pre style="background-color:#2b303b;">
<span style="background-color:#2b303b;color:#c0c5ce;">  let g:formatdef_rustfmt = &#39;&quot;rustfmt&quot;&#39;
</span><span style="background-color:#2b303b;color:#c0c5ce;">  let g:formatters_rust = [&#39;rustfmt&#39;]
</span></pre>
<p>Now you can call <code>:Autoformat</code> to automatically format your Rust code. Optionally you can map it to something more convenient, I use <code>&lt;Leader&gt;f</code></p>
<pre style="background-color:#2b303b;">
<span style="background-color:#2b303b;color:#c0c5ce;">  nmap &lt;Leader&gt;f :Autoformat&lt;CR&gt;
</span></pre>
<p>Or you can instruct Vim to automatically format on save, which is only convenient if the formatter is fast enough. (<code>rustfmt</code> is blazing fast)</p>
<pre style="background-color:#2b303b;">
<span style="background-color:#2b303b;color:#c0c5ce;">  au BufWrite * :Autoformat
</span></pre>
<p>Now go ahead and integrate <code>rustfmt</code> into your preferred editor! It's a great way to keep your code consistent and a tight editor integration will ensure your workflow is never disrupted and that you will never forget to rustfmt anything again.</p>

    </article>
  </main>
  <footer>
  <hr>
  <p>
    <a href="/license/">CC BY-SA 4.0 / MIT</a>
    -
    <a href="https://github.com/cobalt-org/cobalt.rs">Built with Cobalt</a>
  </p>
  <br>
</footer>

</body>
</html>
